<!DOCTYPE html>
<html lang="en">

  <head>
  <title>coinQuest</title>
  <link rel="stylesheet" href="/style.css">
  <meta name="viewport" content="width = device-width, height = device-height">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Silkscreen&display=swap" rel="stylesheet">
  <meta charset="utf-8">
  <link rel="apple-touch-icon" sizes="180x180" href="/fav/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/fav/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/fav/favicon-16x16.png">
  <link rel="manifest" href="/fav/site.webmanifest">

  <!-- Yandex SDK only inside Yandex container/iframe -->
  <script>
    (function(){
      try{
        var inIframe = typeof window !== 'undefined' && window.parent && window.parent !== window;
        var ref = (typeof document !== 'undefined' && document.referrer) ? document.referrer : '';
        var onYandexHost = /yandex\./i.test(ref) || /yandex\./i.test((location && location.hostname) || '');
        if (inIframe || onYandexHost) {
          var s=document.createElement('script');
          s.src='https://yandex.ru/games/sdk/v2';
          s.async=true;
          document.head.appendChild(s);
        }
      }catch(_){}}
    )();
  </script>

  <!-- Stacks UMDs are not needed in React build; using npm packages instead -->
  </head>

<body oncontextmenu="return false;">
  <div id="turnLandscape">
    rotate your device
    <img style='margin-top: 30px' id='rotateIcon' src="/assets/gui/orientation.png" alt="">
  </div>
  <main>

    <div class="wrapper screenRatio">
      <div class="loader">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
      <div class="controlBlock hide">
        Controls
        <img class='controlButton' src="/assets/gui/W.png" alt="">
        <div><img class='controlButton' src="/assets/gui/A.png" alt="">
          <img class='controlButton' src="/assets/gui/S.png" alt="">
          <img class='controlButton' src="/assets/gui/D.png" alt="">
        </div>
      </div>
      <canvas width="0" height="0" class="canvas" id="canvas">
      </canvas>
      <img class="pauseButton button hide" src="/assets/gui/Pause.png" alt="" onclick="PauseToggle(); if(window.clickSound) clickSound.play()">
      <div class="score hide"></div>
      <div class="coins hide">
        <div class="coinsText"></div>
        <img src="/assets/sprites/collect/coin.png" alt="">
      </div>

      <div class="leftButtonsBlock hide">
        <img id="mobileLeftButton" ontouchstart="leftPressed = true; this.style.opacity = '0.5'"
          ontouchend="leftPressed = false;  this.style.opacity = '1'" class="mobileControlButt"
          src="/assets/gui/left.png" alt="">
        <img id="mobileRightButton" ontouchstart="rightPressed = true; this.style.opacity = '0.5'"
          ontouchend="rightPressed = false; this.style.opacity = '1'" class="mobileControlButt"
          src="/assets/gui/right.png" alt="">
      </div>

      <div class="rightButtonsBlock hide">
        <img id="mobileUpButton" ontouchstart="jumpBegin(); this.style.opacity = '0.5'"
          ontouchend="this.style.opacity = '1'" class="mobileControlButt" src="/assets/gui/up.png" alt="">
        <img id="mobileDownButton" ontouchstart="slideBegin(); this.style.opacity = '0.5'"
          ontouchend="slideEnd(); this.style.opacity = '1'" class="mobileControlButt"
          src="/assets/gui/down.png" alt="">
      </div>



    </div>
    <div class="pause insideScreenRatio hide">
      PAUSED
      <div class="buttonHolder ">
        <img class='replayButton button' src="/assets/gui/Redo.png" alt="" onclick="Replay(); if(window.clickSound) clickSound.play()">
        <img class="playOnPauseButton button" src="/assets/gui/Play.png" alt=""
          onclick="PauseToggle(); if(window.clickSound) clickSound.play()">
        <img class='homeButton button' src="/assets/gui/Home.png" alt="" onclick="GoToHome(); if(window.clickSound) clickSound.play()">
      </div>
    </div>
    <div class="gameOver insideScreenRatio hide">
      <div class='HIandRecord'></div>
      <div class="score gameOverScore"></div>      
      <div class="gameOverCoinsHolder">
        <div class="gameOverCoins"></div>
          <img class='payForLifeImg' src="/assets/sprites/collect/coin.png" alt="">
     </div>
      <div class="saveMeHolder">
        save me!
        <div class="saveMeButtonsHolder">
          <div id="endGameButton" class="payForLife smallBtn saveBtn" onclick="finalizeGameScore()">
            <span id="endGamebuttonText">END GAME</span>
            <img class='payForLifeImg' src="/assets/sprites/collect/coin.png" alt="">
          </div>
             <div id="saveButton" class="payForLife smallBtn saveBtn" onclick="buyLifeLine()">
              <span id="SaveMebuttonText">Save Me!</span>
            </div>
             <br>
        </div>
        
        
      </div>
      
      <div class="buttonHolder">
        <img class='homeButton button' src="/assets/gui/Home.png" alt="" onclick="GoToHome(); if(window.clickSound) clickSound.play()">
        <img class='replayButton button' src="/assets/gui/Redo.png" alt="" onclick="Replay(); if(window.clickSound) clickSound.play()">
      </div>
    </div>
    <div class="mainMenu mainBg hide screenRatio">
      <div class="mainMenuSide">
        <ul class="circles">
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
        </ul>
        <div class='mainTitle'>
         coinQuest
        </div>

        <div class="mainMenuButtons">

          <div class='menuButton' 
          onclick="PlayButtonActivate(); if(window.clickSound) clickSound.play(); if(window.bgMusic) bgMusic.play(); ">
            <img src="/assets/gui/Play.png" alt="">
            play
          </div>
          
          <div id="walletArea" class="walletArea">
            <div class='connectButton walletDisconnected' onclick="if(typeof window.connectWallet === 'function') { window.connectWallet(); } else { console.log('Wallet not ready yet'); }">
              <img src="/assets/gui/achives.png" alt=""> 
              <span class="walletText">Connect Wallet</span>
              <span class="connectHint">(Stacks wallet required)</span>
            </div>
          </div>
          
        </div>
        <div class="mainLeftInfo">
          <div class="mainLeftWrapper">
            <img id='prizeImg' src="/assets/gui/prize.png" alt="Prize icon">
            <div class='HighScoreBlock mainStatText'></div>
          </div>
          <div class="mainLeftWrapper">
            <img id='coinImg' src="/assets/sprites/collect/coin.png" alt="Coin icon">
            <div class='mainCoinsText mainStatText'></div>
          </div>
        </div>


        <div class="rightTopBlock">
          <img class='smallBtn soundBtn' onclick="mutePage(); if(window.clickSound) clickSound.play()" alt="">
          <img class='smallBtn settingsBtn' src="/assets/gui/achives.png" onclick="toggleHide(settingsPanel); if(window.clickSound) clickSound.play()" alt="">
          <img class='smallBtn rewardsBtn' src="/assets/gui/prize.png" onclick="toggleHide(rewardsBlock); if(window.clickSound) clickSound.play()" alt="">
        </div>

      </div>
    </div>
    <div class="tutorial  hide"></div>
    <div class="settingsPanel insideScreenRatio hide">
      <div class="panelContainer">
        <div class="settingsHeader">
          <h2 class="settingsTitle">‚öôÔ∏è Game Settings</h2>
          <p class="settingsSubtitle">Customize your gaming experience</p>
        </div>
        
        <div class="settingsContent">
          <div class="settingsGrid">
            <div class="settingCard audioCard">
              <div class="settingIcon">üîä</div>
              <div class="settingInfo">
                <h3>Audio Settings</h3>
                <p>Control game sounds and music</p>
                <div class="settingStatus">
                  <span class="statusIcon">üéµ</span>
                  <span class="statusText">Audio enabled</span>
                </div>
              </div>
              <div class="settingControl">
                <button class='settingBtn audioBtn' onclick="mutePage(); if(window.clickSound) clickSound.play()">
                  <span class="btnIcon">üîä</span>
                  <span class="btnText">Toggle Mute</span>
                </button>
              </div>
            </div>
            
            <div class="settingCard controlsCard">
              <div class="settingIcon">üéÆ</div>
              <div class="settingInfo">
                <h3>Game Controls</h3>
                <p>Use these keys to control your character</p>
                <div class="settingStatus">
                  <span class="statusIcon">‚å®Ô∏è</span>
                  <span class="statusText">WASD or Arrow Keys</span>
                </div>
              </div>
              <div class="settingControl">
                <div class="controlsDisplay">
                  <span class="controlKey">W</span>
                  <span class="controlKey">A</span>
                  <span class="controlKey">S</span>
                  <span class="controlKey">D</span>
                </div>
              </div>
            </div>
            
            <div class="settingCard walletCard">
              <div class="settingIcon">üíº</div>
              <div class="settingInfo">
                <h3>Wallet Connection</h3>
                <p>Connect your wallet to earn rewards</p>
                <div class="settingStatus">
                  <span class="statusIcon">üîó</span>
                  <span class="statusText" id="walletStatusText">Checking connection...</span>
                </div>
              </div>
              <div class="settingControl">
                <div id="walletStatus" class="walletStatus">Not Connected</div>
                <button class='settingBtn walletBtn' onclick="openWalletSettings(); if(window.clickSound) clickSound.play()">
                  <span class="btnIcon">‚öôÔ∏è</span>
                  <span class="btnText">Manage</span>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="return-btn-holder">
          <button class='btn return-btn' onclick="toggleHide(settingsPanel); if(window.clickSound) clickSound.play()">
            ‚Üê Back to Game
          </button>
        </div>
      </div>
    </div>
    <div class="rewards mainBg screenRatio hide">
      <div class="panelContainer">
        <div class="rewardsHeader">
          <h2 class="rewardsTitle">üèÜ Rewards Center</h2>
          <p class="rewardsSubtitle">Claim your earned rewards from the last game run</p>
        </div>
        
        <div class="rewardsContent">
          <div class="rewardsGrid">
            <div class="rewardCard coinsCard">
              <div class="rewardIcon">ü™ô</div>
              <div class="rewardInfo">
                <h3>Coins Earned</h3>
                <div class="rewardValue" id="lastCoinsText">0</div>
                <p class="rewardDescription">Coins collected in last run</p>
              </div>
            </div>
            
            <div class="rewardCard scoreCard">
              <div class="rewardIcon">‚≠ê</div>
              <div class="rewardInfo">
                <h3>Score Achieved</h3>
                <div class="rewardValue" id="lastScoreText">0</div>
                <p class="rewardDescription">Final score from last run</p>
              </div>
            </div>
          </div>
          
          <div class="claimSection">
            <div class="claimInfo">
              <h3>Ready to Claim?</h3>
              <p>Your rewards will be sent to your connected wallet address</p>
            </div>
            <button class='claimBtn' id="claimLastRunBtn" onclick="claimLastRun(); if(window.clickSound) clickSound.play()">
              <span class="claimIcon">üí∞</span>
              <span class="claimText">Claim Rewards</span>
            </button>
            <div class="walletRequirement">
              <span class="requirementIcon">üíº</span>
              <span class="requirementText">Wallet must be connected to claim rewards</span>
            </div>
          </div>
        </div>
        
        <div class="return-btn-holder">
          <button class='btn return-btn' onclick="toggleHide(rewardsBlock); if(window.clickSound) clickSound.play()">
            ‚Üê Back to Game
          </button>
        </div>
      </div>
    </div>
    <div class="achives mainBg screenRatio hide">
      <div class="statsHolder">
        <div class="stat" id="numberOfDeathsBlock"></div>
        <div class='stat ' id="numberOfJumpsBlock"></div>
        <div class='stat' id="numberOfslidesBlock"></div>
      </div>
      <div class="achivesHolder">
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/gui/pioneer.png" alt="">
          <div class='achiveText'>
            <p>Pioneer</p>
            Score 100 points
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/gui/bomb.png" alt="">
          <div class='achiveText'>
            <p>Extreme</p>
            Score 300 points
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/gui/motorbike.png" alt="">
          <div class='achiveText'>
            <p>Racer</p>
            Score 500 points
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/gui/trees.png" alt="">
          <div class='achiveText'>
            <p>Run forest, run</p>
            Score 750 points
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/gui/gigachad.png" alt="">
          <div class='achiveText'>
            <p>Gigachad</p>
            Score 1000 points
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/gui/dead cat.png" alt="">
          <div class='achiveText'>
            <p>Puss in boots</p>
            Die 8 times
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/gui/guitar.png" alt="">
          <div class='achiveText'>
            <p>Smells like Nirvana</p>
            Die 27 times
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/gui/earth.png" alt="">
          <div class='achiveText'>
            <p>Main question</p>
            Die 42 times
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/gui/skull.png" alt="">
          <div class='achiveText'>
            <p>Memento mori</p>
            Die 100 times
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/gui/bouncer.png" alt="">
          <div class='achiveText'>
            <p>Bouncer</p>
            Jump 500 times
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/gui/slide.png" alt="">
          <div class='achiveText'>
            <p>On the ground</p>
            Slide under barriers 300 times
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/sprites/collect/shieldIcon.png" alt="">
          <div class='achiveText'>
            <p>S.H.I.E.L.D.</p>
            Upgrade shield to max
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/sprites/collect/boosterIcon.png" alt="">
          <div class='achiveText'>
            <p>Flash</p>
            Upgrade booster to max
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/sprites/collect/coin.png" alt="">
          <div class='achiveText'>
            <p>Uncle Pennybags</p>
            Earn 1000 coins
          </div>
        </div>
        <div class="achiveBlock lock"><img class='achiveImg' src="/assets/gui/success.png" alt="">
          <div class='achiveText'>
            <p>All for one</p>
            Unlock all achives
          </div>
        </div>
      </div>
      <div class="return-btn-holder">
        <button class='btn return-btn' onclick="toggleHide(achivesBlock); if(window.clickSound) clickSound.play()">
          Return
        </button>
      </div>
    </div>
    <div class="store mainBg screenRatio hide">
      <div class="storeHolder">
        <div class="storeBack"></div>
        <div class="storeCoins">
          <div class="storeCoinsText"></div>
          <img src="/assets/sprites/collect/coin.png" alt="">
        </div>
          <img class='addBtn' src="/assets/gui/add.png" alt=""
            onclick="showRevawardVideo(addCoins); if(window.clickSound) clickSound.play()"><br>
        <div class="upgradesWrapper">
          <div class="upgrade">
            <div class="shieldUpgradeHolder">
              Shield
              <div class="upgradeHolder">
                <img src="/assets/sprites/collect/shieldIcon.png" alt="">
                <div class="upgradeProgress">
                  <div class="upgradeLevel shieldLevel"></div>
                  <div class="upgradeLevel shieldLevel"></div>
                  <div class="upgradeLevel shieldLevel"></div>
                  <div class="upgradeLevel shieldLevel"></div>
                </div>
              </div>
            </div>
            <div class="upgradeBtn smallBtn" onclick="Upgrade('shield')">
              <div class="upgradeBtnContent">
                <div class="shieldCost"></div>
                <img src="/assets/sprites/collect/coin.png" class="upgradeCoinImg" alt="">
              </div>
            </div>
          </div>
          <div class="upgrade">
            <div class="boosterUpgradeHolder">
              Booster
              <div class="upgradeHolder">
                <img src="/assets/sprites/collect/boosterIcon.png" alt="">
                <div class="upgradeProgress">
                  <div class="upgradeLevel boosterLevel"></div>
                  <div class="upgradeLevel boosterLevel"></div>
                  <div class="upgradeLevel boosterLevel"></div>
                  <div class="upgradeLevel boosterLevel"></div>
                </div>
              </div>
            </div>
            <div class="upgradeBtn smallBtn" onclick="Upgrade('booster')">
              <div class="upgradeBtnContent">
                <div class="boosterCost"></div>
                <img src="/assets/sprites/collect/coin.png" class="upgradeCoinImg" alt="">
              </div>
            </div>
          </div>

        </div>
      </div>
      <button class='btn return-btn store-return-btn' onclick="toggleHide(storeBlock); if(window.clickSound) clickSound.play()">
        Return
      </button>

  </main>

  <!-- Legacy vanilla scripts from public/scripts -->
  <script>
    // Prevent script loading conflicts
    if (typeof window.scriptLoaded === 'undefined') {
      window.scriptLoaded = {};
    }
    
    // Enhanced error handling for external script conflicts
    window.addEventListener('error', function(e) {
      // Handle external script conflicts (browser extensions)
      if (e.message.includes('observer') && e.filename.includes('content.js')) {
        console.warn('üîß External script conflict detected (browser extension):', e.message);
        console.warn('üí° This is likely caused by a browser extension. Your game should still work normally.');
        e.preventDefault();
        return false;
      }
      
      // Handle other external script conflicts
      if (e.filename && (e.filename.includes('extension') || e.filename.includes('content_script'))) {
        console.warn('üîß Browser extension script error:', e.message);
        e.preventDefault();
        return false;
      }
      
      // Log other errors for debugging but don't prevent them
      if (e.filename && !e.filename.includes(window.location.hostname)) {
        console.warn('‚ö†Ô∏è External script error:', e.message, 'from', e.filename);
      }
    });
    
    // Script isolation to prevent conflicts
    (function() {
      'use strict';
      
      // Store original console methods
      const originalConsoleError = console.error;
      const originalConsoleWarn = console.warn;
      
      // Override console.error to filter external script errors
      console.error = function(...args) {
        const message = args.join(' ');
        if (message.includes('observer') && message.includes('content.js')) {
          console.warn('üîß Filtered external script error:', message);
          return;
        }
        originalConsoleError.apply(console, args);
      };
      
      // Override console.warn to filter external script warnings
      console.warn = function(...args) {
        const message = args.join(' ');
        if (message.includes('observer') && message.includes('content.js')) {
          return; // Suppress these warnings
        }
        originalConsoleWarn.apply(console, args);
      };
    })();
    
    // User-friendly notification about browser extensions
    setTimeout(() => {
      if (window.location.protocol === 'file:' || window.location.hostname === 'localhost') {
        console.log('üéÆ CoinQuest Game Loaded Successfully!');
        console.log('üí° If you see any "observer" errors above, they are from browser extensions and won\'t affect your game.');
        console.log('üîß To disable these errors, try running the game in incognito mode or disable browser extensions.');
      }
    }, 2000);
  </script>
  <script src="/scripts/howler.core.js"></script>
  <script src="/scripts/PxLoader.js"></script>
  <script src="/scripts/PxLoaderImage.js"></script>
  <script src="/scripts/yandexScripts.js"></script>
  <script src="/scripts/vars.js"></script>
  <script src="/scripts/loader.js"></script>
  <script src="/scripts/particles.js"></script>
  <script src="/scripts/screenShake.js"></script>
  <script src="/scripts/powerUps.js"></script>
  <script src="/scripts/dynamicBackgrounds.js"></script>
  <script src="/scripts/game.js"></script> <!-- Re-enabled for button functionality -->
  <script src="/scripts/walletBridge.js"></script>

  <!-- React bundle -->
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>

</html>
